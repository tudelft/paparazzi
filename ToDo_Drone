 
- forcast wave 0.5 to 1.0 sec 
- substract wave from ship position so that descent line is not moving by the waves
- plot ship movement in 2d plot
- 

- get a dataset from a real ship with IMU
- kan basis-gps van drone ook worden ingesteld in paparazzi als secondary gps?


- bebop GPS take-over als backup

Notes from phone:
+ Make Matlab autosave figures after analisys
+ Add dotted lines in Matlab to show when approach_moving_target is enabled
+ Make every gps-fix save the TOW as timestamp, to make the feedforward accurate with drone and groundstation
? Try to make an all-purpose XML file with IF statements (tried, but without success)
- make set_target_offset_here() work in flightplan
- make better implementation of function approach_ship_enable() (maybe get rid of keep-allive function?)
- make drone software robust for GPS disconnection mid-flight
- test Set_offset_here (function did not seem to work in the field)
- mangage logfiles (store them in folders)
- Add Uplink messages also to logfiles
- Improve Matlab analisys somehow to show tracking error more clear
- Break harder in guidance_indi when in front of WP (prevent crash into truck/ship cabin)
- Check if bebop speed is completely dependend of guidance_indi, or are there maybe other modules forcing the drone to move?
- Make RTK system in drone robust to loss of RTCM messages
- Add info to internal logging on drone (logging declared in airframe)
- Analyse what factors cause overshoot of WP in guidance (control params/gps-noise/abrubpt-speedchange)
- Plan how to make dataset with gyro/accelerometer at rough sea somehow
- Is there a Derrivative in guidance_indi?
- Only use sonar when drone is sure it is above the deck/truck
- Define better what happens when approach_moving_target_enable() is stoped
- Make sure that guidance_indi/approach does not go des_pos, except when needed
~ Filter ship gps position based on heading/cog (filter roll, but not froward movement)
~ Filter/smooth signal inside GPS module (watch out for inducing delays)


- = TODO
~ = TODO later
+ = DONE
? = TRIED, but failed

Specific aproach_ship test after failed testflight at valkenburg 27-10-2022
+ position ground-gps (red dot) in GCS at right place (also move to see if red dot is moving)
+ position target_pos at right place in GCS (according to values in target_pos module)
+ position des_pos at right place in GCS (according to values in approach module)
+ GCS waypoints moving when rotating ground-gps (also when approach_enable function is not used)
+ Drone rel_despos is correct with static placement of drone wrt ground-gps (see if de relative distances are logic)
+ Drone rel_targetpos is correct with static placement of drone wrt ground-gps (see if de relative distances are logic)
+ Drone des_vel/des_accel in approach module logic with relative distance rel_despos
+ Check ALL altitudes with static placement drone and ground-gps
+ Check if approach_enable function still works as it should (WP_approach moves to WP_ship)

- Speed SP not stopping when target_pos timeout
- bug WP_approach stoped updating (gcs shows it at WP_HOME)
- bug rel_refpos NAN when drone on top of it



Factors causing overshoot WP:
- gcs no gps-pos update send, but target changed heading/speed
- amt.relvel_gain (approach speed gain) higher than 1.0
- amt.speed_gain (target speed gain) higher than 1.0
- amt.pos_gain (position error gain) too high, so the drone does not slow down early enough
- integration_compensation (if used) because set to 0.0 when passing error=0, but at that point speed is too high
- drone is on WP and ship/truck descellerates (drone always beyond WP in this case)


code to test:
  float ship_rotation = RadOfDeg(target_heading); 
  float offset_centerline_ship = rel_target_pos.x * cosf(ship_rotation) - rel_target_pos.y * sinf(ship_rotation);
  float behind_ship            = rel_target_pos.x * sinf(ship_rotation) + rel_target_pos.y * cosf(ship_rotation);

  printf("ship_rotation: %f \t offset_centerline %f \t behind_ship %f \n", ship_rotation, offset_centerline_ship, behind_ship);
  
  
ivy messages ground bar
GPS_INJECT: ground GPS_INJECT 203 0 211,0,30,68,96,0,75,38,56,96,0,0,0,0,0,64,0,0,0,0,32,0,0,0,84,118,92,203,126,89,97,73,160,77,21,19 
GPS_INJECT: ground GPS_INJECT 203 0 211,0,4,76,224,0,128,237,237,214 
TARGET_POS 203 203 519906555 43751326 15681 0.036000 0.397000 162.070953 nan 
GPS_INJECT: ground GPS_INJECT 203 0 211,0,126,254,128,0,1,0,0,20,178,99,134,0,1,36,98,120,95,192,89,123,2,27,151,75,14,209,114,0,21,32,0,2,86,0,22,182,0,0,0,0,0,0,0,0,0,1,134,100,36,0,0,0,28,222,120,160,0,0,17,253,230,160,0,0,0,240,165,46,0,0,0,77,2,119,128,0,0,68,227,229,0,0,0,0,151,82,230,0,0,0,94,62,169,255,255,255,164,162,196,0,0,3,142,213,245,255,255,254,226,150,204,0,0,13,97,37,160,0,0,0,0,0,0,0,0,0,0,81,162,215 
ground FLIGHT_PARAM GCS 0.000000 0.000000 nan 51.990763 4.375148 0.302000 68.985992 60.686001 -0.090000 0.000000 1666854912.000000 371668100 0.000000



GPS_INJECT: ground GPS_INJECT 203 0 211,0,123,67,32,0,89,16,112,134,0,0,88,64,6,1,0,0,0,0,32,0,128,0,127,86,140,134,144,162,154,156,156,191,196,30,30,40,165,144,32,159,206,223,166,187,207,247,25,149,86,42,21,200,236,134,201,63,238,203,60,91,192,9,239,254,102,167,225,25,111,117,56,66,189,178,10,171,135,228,108,112,115,170,194,112,144,249,249,143,226,195,205,205,221,144,221,192,2,52,65,91,243,186,203,211,74,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,171,227,46 
GPS_INJECT: ground GPS_INJECT 203 0 211,0,109,67,192,0,137,60,197,70,0,0,3,129,6,0,0,0,0,0,32,128,0,0,93,90,18,2,90,114,50,7,215,240,234,225,90,224,34,255,126,30,50,60,219,78,15,170,221,12,193,190,195,170,127,147,16,20,152,240,77,223,254,179,249,126,171,41,233,71,24,29,168,64,78,218,110,238,134,238,132,67,83,146,177,61,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,165,206,252 
GPS_INJECT: ground GPS_INJECT 203 0 211,0,80,68,96,0,89,16,112,132,0,0,1,8,16,0,64,0,0,0,32,1,0,0,95,174,39,42,40,153,27,212,37,7,19,18,230,117,200,84,101,96,179,94,20,124,1,194,113,38,249,208,127,228,24,160,99,153,129,96,179,248,168,203,224,52,244,203,186,203,1,28,208,196,236,241,128,0,0,0,0,0,0,9,62,232 
GPS_INJECT: ground GPS_INJECT 203 0 211,0,4,76,224,0,128,237,237,214 
ground FLIGHT_PARAM GCS 0.000000 0.000000 261.253632 51.989826 4.375754 0.026000 81.101112 48.139999 0.014000 0.000000 1666856704.000000 373562400 0.000000 
TARGET_POS 203 203 519898255 43757544 48140 0.026000 0.014000 81.101112 261.253632 
ground FLIGHT_PARAM GCS 0.000000 0.000000 261.170258 51.989826 4.375754 0.037000 81.101112 48.139000 0.020000 0.000000 1666856704.000000 373562500 0.000000 
TARGET_POS 203 203 519898255 43757544 48139 0.037000 0.020000 81.101112 261.170258 
GPS_INJECT: ground GPS_INJECT 203 0 211,0,126,254,128,0,1,0,0,21,145,7,8,64,1,36,100,44,3,128,89,126,204,42,151,75,5,68,192,0,2,54,0,0,109,255,255,164,0,0,0,0,0,0,0,0,0,0,0,249,4,101,0,0,0,39,161,60,64,0,0,11,222,137,96,0,0,3,138,67,20,0,0,0,121,178,159,0,0,0,90,110,142,128,0,0,6,188,126,64,0,0,2,191,196,255,255,255,248,89,215,0,0,0,75,129,87,255,255,255,247,148,64,0,0,0,179,1,216,0,0,0,0,0,0,0,0,0,0,165,60,111 
GPS_INJECT: ground GPS_INJECT 203 0 211,0,123,67,32,0,89,16,115,166,0,0,88,64,6,1,0,0,0,0,32,0,128,0,127,86,140,134,144,162,154,156,156,191,196,30,30,38,166,16,64,153,21,114,51,252,203,121,15,125,130,250,112,72,247,62,78,165,93,199,122,80,2,151,84,8,156,59,232,242,15,148,158,63,195,111,254,194,132,36,101,15,43,39,125,59,195,245,236,167,210,117,93,205,221,144,221,192,2,52,65,91,211,186,203,211,74,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,159,162,194 
GPS_INJECT: ground GPS_INJECT 203 0 211,0,94,67,192,0,137,60,200,102,0,0,3,128,6,0,0,0,0,0,32,128,0,0,93,104,72,9,104,200,31,95,195,171,46,2,41,55,160,103,128,214,196,234,5,89,16,84,34,8,36,153,128,69,253,64,243,232,5,168,140,12,115,144,68,202,0,195,176,221,221,221,208,16,212,228,179,208,224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,144,96,119 
GPS_INJECT: ground GPS_INJECT 203 0 211,0,80,68,96,0,89,16,115,164,0,0,1,8,16,0,64,0,0,0,32,1,0,0,95,174,39,42,40,153,59,212,37,7,105,31,215,39,169,183,238,183,198,112,6,255,230,61,86,251,245,253,71,212,204,143,237,1,63,134,57,0,113,71,255,86,36,203,186,203,1,28,208,196,236,241,128,0,0,0,0,0,0,181,102,208 
GPS_INJECT: ground GPS_INJECT 203 0 211,0,4,76,224,0,128,237,237,214 
ground FLIGHT_PARAM GCS 0.000000 0.000000 261.172577 51.989826 4.375755 0.043000 81.101112 48.146999 0.030000 0.000000 1666856704.000000 373562600 0.000000 
TARGET_POS 203 203 519898255 43757545 48147 0.043000 0.030000 81.101112 261.172577 
GPS_INJECT: ground GPS_INJECT 203 0 211,0,126,254,128,0,1,0,0,21,145,7,58,64,1,36,100,44,7,128,89,126,204,73,151,75,5,69,46,0,2,8,0,3,82,0,1,62,0,0,0,0,0,0,0,0,0,0,0,249,5,254,0,0,0,39,161,123,0,0,0,11,222,151,208,0,0,3,138,65,108,0,0,0,121,178,145,128,0,0,90,110,131,0,0,0,6,203,139,192,0,0,2,189,84,255,255,255,248,58,119,0,0,0,75,121,205,255,255,255,247,130,204,0,0,0,179,114,184,0,0,0,0,0,0,0,0,0,0,124,139,84 
GPS_INJECT: ground GPS_INJECT 203 0 211,0,123,67,32,0,89,16,117,54,0,0,88,64,6,1,0,0,0,0,32,0,128,0,127,86,140,134,144,162,154,156,156,191,196,30,30,38,166,16,64,153,184,227,122,189,73,122,9,113,153,226,158,8,127,154,31,87,237,69,217,78,195,222,27,13,183,111,236,222,127,164,73,254,70,89,248,206,0,4,42,239,134,229,126,161,93,243,230,39,202,92,61,205,221,144,221,192,2,52,65,91,211,186,203,211,74,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,195,189,79 
GPS_INJECT: ground GPS_INJECT 203 0 211,0,94,67,192,0,137,60,201,246,0,0,3,128,6,0,0,0,0,0,32,128,0,0,93,104,72,9,104,200,31,95,195,171,46,2,41,215,239,170,31,92,124,238,19,211,17,132,36,88,56,154,240,22,153,128,54,91,253,172,216,41,102,16,73,136,192,214,153,221,221,221,208,16,212,228,179,208,224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,189,157,68 
GPS_INJECT: ground GPS_INJECT 203 0 211,0,80,68,96,0,89,16,117,52,0,0,1,8,16,0,64,0,0,0,32,1,0,0,95,174,39,42,40,153,59,212,37,7,116,148,207,125,154,95,179,151,80,1,0,65,216,126,201,212,244,19,167,205,38,239,177,183,190,153,13,4,85,156,14,232,117,203,186,203,1,20,208,196,236,241,128,0,0,0,0,0,0,17,7,133 
GPS_INJECT: ground GPS_INJECT 203 0 211,0,4,76,224,0,128,237,237,214 


