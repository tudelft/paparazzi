<!DOCTYPE module SYSTEM "module.dtd">

<module name="Overactuated_mixing" dir="Overactuated_vehicle">
  <doc>
    <description>Overactuated Vehicle Mixing</description>
  </doc>

  <settings>
    <dl_settings>
      <dl_settings NAME="FBW Control">
        <dl_setting var="K_p_rad_s_dshot"  min="0" step=".1" max="20" shortname="K_p_rad_s_dshot" />
        <dl_setting var="K_i_rad_s_dshot"  min="0" step=".001" max="1" shortname="K_i_rad_s_dshot" />
        <dl_setting var="K_d_rad_s_dshot"  min="0" step=".1" max="20" shortname="K_d_rad_s_dshot" />

        <dl_setting var="K_indi_rad_s_dshot"  min="0" step=".1" max="200" shortname="K_indi_rad_s_dshot" />

        <dl_setting var="Des_RPM_motor_1"  min="0" step="100" max="20000" shortname="Des_RPM_motor_1" />

        <dl_setting var="Des_dshot_steps_motor_1"  min="0" step="1" max="16" shortname="Des_dshot_steps_motor_1" />

        <dl_setting var="min_pwm_servo_9"  min="0" step="1" max="2500" shortname="min_pwm_servo_9" />
        <dl_setting var="max_pwm_servo_9"  min="0" step="1" max="2500" shortname="max_pwm_servo_9" />
        <dl_setting var="neutral_pwm_servo_9"  min="0" step="1" max="2500" shortname="neutral_pwm_servo_9" />
        <dl_setting var="desired_angle_servo_9"  min="-50" step="1" max="50" shortname="desired_angle_servo_9" />

        <dl_setting var="min_pwm_servo_10"  min="0" step="1" max="2500" shortname="min_pwm_servo_10" />
        <dl_setting var="max_pwm_servo_10"  min="0" step="1" max="2500" shortname="max_pwm_servo_10" />
        <dl_setting var="neutral_pwm_servo_10"  min="0" step="1" max="2500" shortname="neutral_pwm_servo_10" />
        <dl_setting var="desired_angle_servo_10"  min="-50" step="1" max="50" shortname="desired_angle_servo_10" />

        <dl_setting var="des_az_angle_test"  min="-200" step="1" max="200" shortname="des_az_angle_test" />
        <dl_setting var="des_el_angle_test"  min="-200" step="1" max="200" shortname="des_el_angle_test" />

      </dl_settings>
    </dl_settings>
  </settings>

  <settings>
    <dl_settings>
      <dl_settings NAME="General overact">

        <dl_setting var="alt_offset_beacon" min="0" step=".1" max="40" shortname="alt_off_beacon"/>

        <dl_setting var="selected_beacon" min="1" step="1" max="5" shortname="selected_beacon" persistent="true"/>

        <dl_setting var="sixdof_mode" min="1" step="1" max="3" shortname="sixdof_mode" persistent="true"/>

        <dl_setting var="trans_speed" min="0" step=".1" max="50" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_TRANSITION_SPEED_PSEUDOCTR_HEDGE" shortname="trans_speed" persistent="true"/>

        <dl_setting var="vert_acc_margin" min="0" step=".1" max="5" module="Overactuated_vehicle/Overactuated_mixing" param="LIMITS_FWD_VERT_ACC_MARGIN" shortname="vert_acc_margin" persistent="true"/>

        <dl_setting var="fpa_off_deg"  min="-10" step=".01" max="10" shortname="fpa_off_deg" />

        <dl_setting var="overestimation_coeff"  min="0" step=".01" max="2" shortname="overest_coeff" />

        <dl_setting var="K_beta"  min="-5" step=".01" max="5" shortname="K_beta" />

        <dl_setting var="extra_lat_gain"  min="-2" step=".01" max="2" shortname="extra_lat_gain" />

        <dl_setting var="K_T_airspeed"  min="0" step=".001" max="1" shortname="K_T_airspeed" />

        <dl_setting var="K_d_speed"  min="0" step=".001" max="1" shortname="K_d_speed" />

        <dl_setting var="CL_ailerons"  min="0" step=".001" max="0.5" shortname="CL_ailerons" />

        <dl_setting var="yaw_with_tilting_PID" min="0" step="1" max="1" shortname="use_tilt_to_yaw_PID" values="FALSE|TRUE" />

        <dl_setting var="stick_gain_yaw"  min="0" step=".01" max="1" shortname="Stick gain yaw" />
        <dl_setting var="stick_gain_throttle"  min="0" step=".01" max="1" shortname="Stick gain thr" />
      </dl_settings>
    </dl_settings>
  </settings>

  <settings>
    <dl_settings>
      <dl_settings NAME="GAINS/WEIGHTS">

        <!-- INDI cruise gains -->
        <dl_setting var="cruise_gains.p.phi" min="0" step=".001" max="50" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_CRUISE_GAIN_P" shortname="CR_P_GAIN" persistent="true"/>
        <dl_setting var="cruise_gains.d.phi" min="0" step=".001" max="50" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_CRUISE_GAIN_P_DOT" shortname="CR_P_DOT_GAIN" persistent="true"/>

        <dl_setting var="cruise_gains.p.theta" min="0" step=".001" max="50" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_CRUISE_GAIN_Q" shortname="CR_Q_GAIN" persistent="true"/>
        <dl_setting var="cruise_gains.d.theta" min="0" step=".001" max="50" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_CRUISE_GAIN_Q_DOT" shortname="CR_Q_DOT_GAIN" persistent="true"/>

        <dl_setting var="cruise_gains.p.psi" min="0" step=".001" max="50" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_CRUISE_GAIN_R" shortname="CR_R_GAIN" persistent="true"/>
        <dl_setting var="cruise_gains.d.psi" min="0" step=".001" max="50" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_CRUISE_GAIN_R_DOT" shortname="CR_R_DOT_GAIN" persistent="true"/>

        <dl_setting var="cruise_gains.p.x" min="0" step=".001" max="10" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_CRUISE_GAIN_X" shortname="CR_X_GAIN" persistent="true"/>
        <dl_setting var="cruise_gains.d.x" min="0" step=".001" max="10" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_CRUISE_GAIN_X_DOT" shortname="CR_X_DOT_GAIN" persistent="true"/>

        <dl_setting var="cruise_gains.p.y" min="0" step=".001" max="10" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_CRUISE_GAIN_Y" shortname="CR_Y_GAIN" persistent="true"/>
        <dl_setting var="cruise_gains.d.y" min="0" step=".001" max="10" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_CRUISE_GAIN_Y_DOT" shortname="CR_Y_DOT_GAIN" persistent="true"/>

        <dl_setting var="cruise_gains.p.z" min="0" step=".001" max="30" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_CRUISE_GAIN_Z" shortname="CR_Z_GAIN" persistent="true"/>
        <dl_setting var="cruise_gains.d.z" min="0" step=".001" max="30" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_CRUISE_GAIN_Z_DOT" shortname="CR_Z_DOT_GAIN" persistent="true"/>
        
        <!-- INDI cruise gains -->
        <dl_setting var="app_gains.p.phi" min="0" step=".001" max="50" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_APP_GAIN_P" shortname="APP_P_GAIN" persistent="true"/>
        <dl_setting var="app_gains.d.phi" min="0" step=".001" max="50" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_APP_GAIN_P_DOT" shortname="APP_P_DOT_GAIN" persistent="true"/>

        <dl_setting var="app_gains.p.theta" min="0" step=".001" max="50" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_APP_GAIN_Q" shortname="APP_Q_GAIN" persistent="true"/>
        <dl_setting var="app_gains.d.theta" min="0" step=".001" max="50" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_APP_GAIN_Q_DOT" shortname="APP_Q_DOT_GAIN" persistent="true"/>

        <dl_setting var="app_gains.p.psi" min="0" step=".001" max="50" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_APP_GAIN_R" shortname="APP_R_GAIN" persistent="true"/>
        <dl_setting var="app_gains.d.psi" min="0" step=".001" max="50" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_APP_GAIN_R_DOT" shortname="APP_R_DOT_GAIN" persistent="true"/>

        <dl_setting var="app_gains.p.x" min="0" step=".001" max="10" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_APP_GAIN_X" shortname="APP_X_GAIN" persistent="true"/>
        <dl_setting var="app_gains.d.x" min="0" step=".001" max="10" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_APP_GAIN_X_DOT" shortname="APP_X_DOT_GAIN" persistent="true"/>

        <dl_setting var="app_gains.p.y" min="0" step=".001" max="10" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_APP_GAIN_Y" shortname="APP_Y_GAIN" persistent="true"/>
        <dl_setting var="app_gains.d.y" min="0" step=".001" max="10" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_APP_GAIN_Y_DOT" shortname="APP_Y_DOT_GAIN" persistent="true"/>

        <dl_setting var="app_gains.p.z" min="0" step=".001" max="30" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_APP_GAIN_Z" shortname="APP_Z_GAIN" persistent="true"/>
        <dl_setting var="app_gains.d.z" min="0" step=".001" max="30" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_APP_GAIN_Z_DOT" shortname="APP_Z_DOT_GAIN" persistent="true"/>

        <!-- weights -->
        <dl_setting var="w_mot_const" min="0" step=".1" max="1000" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_W_ACT_MOTOR_CONST" shortname="w_mot_const" persistent="true"/>
        <dl_setting var="w_mot_speed" min="-100" step=".1" max="100" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_W_ACT_MOTOR_SPEED" shortname="w_mot_speed" persistent="true"/>

        <dl_setting var="w_el_const" min="-100" step=".1" max="100" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_W_ACT_EL_CONST" shortname="w_el_const" persistent="true"/>
        <dl_setting var="w_el_speed" min="-100" step=".1" max="100" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_W_ACT_EL_SPEED" shortname="w_el_speed" persistent="true"/>

        <dl_setting var="w_az_const" min="-100" step=".1" max="100" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_W_ACT_AZ_CONST" shortname="w_az_const" persistent="true"/>
        <dl_setting var="w_az_speed" min="-100" step=".1" max="100" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_W_ACT_AZ_SPEED" shortname="w_az_speed" persistent="true"/>
        
        <dl_setting var="w_theta_const" min="0" step=".1" max="2000" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_W_ACT_THETA_CONST" shortname="w_theta_const" persistent="true"/>
        <dl_setting var="w_theta_speed" min="-100" step=".1" max="100" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_W_ACT_THETA_SPEED" shortname="w_theta_speed" persistent="true"/>

        <dl_setting var="w_phi_const" min="0" step=".1" max="2000" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_W_ACT_PHI_CONST" shortname="w_phi_const" persistent="true"/>
        <dl_setting var="w_phi_speed" min="-100" step=".1" max="100" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_W_ACT_PHI_SPEED" shortname="w_phi_speed" persistent="true"/>

        <dl_setting var="w_ail_const" min="0" step=".1" max="100" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_W_ACT_AILERONS_CONST" shortname="w_ail_const" persistent="true"/>
        <dl_setting var="w_ail_speed" min="-100" step=".1" max="100" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_W_ACT_AILERONS_SPEED" shortname="w_ail_speed" persistent="true"/>
        
        <!-- PID gains -->
        <dl_setting var="pid_gains_over.p.phi" min="0" step="1" max="1200" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_PID_P_GAIN_PHI" shortname="PID_kp_roll" persistent="true"/>
        <dl_setting var="pid_gains_over.i.phi" min="0" step=".1" max="5" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_PID_I_GAIN_PHI" shortname="PID_ki_roll" persistent="true"/>
        <dl_setting var="pid_gains_over.d.phi" min="0" step="1" max="300" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_PID_D_GAIN_PHI" shortname="PID_kd_roll" persistent="true"/>

        <dl_setting var="pid_gains_over.p.theta" min="0" step="1" max="1200"  module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_PID_P_GAIN_THETA" shortname="PID_kp_pitch" persistent="true"/>
        <dl_setting var="pid_gains_over.i.theta" min="0" step=".1" max="50" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_PID_I_GAIN_THETA" shortname="PID_ki_pitch" persistent="true"/>
        <dl_setting var="pid_gains_over.d.theta" min="0" step="1" max="300" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_PID_D_GAIN_THETA" shortname="PID_kd_pitch" persistent="true"/>

        <dl_setting var="pid_gains_over.p.psi" min="0" step=".01" max="40" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_PID_P_GAIN_PSI" shortname="PID_kp_yaw" persistent="true"/>
        <dl_setting var="pid_gains_over.i.psi" min="0" step=".01" max="20" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_PID_I_GAIN_PSI" shortname="PID_ki_yaw" persistent="true"/>
        <dl_setting var="pid_gains_over.d.psi" min="0" step=".01" max="20" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_PID_D_GAIN_PSI" shortname="PID_kd_yaw" persistent="true"/>

        <dl_setting var="pid_gains_over.p.x" min="0" step=".01" max="5" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_PID_P_GAIN_POS_X_TILT" shortname="PID_kp_x" persistent="true"/>
        <dl_setting var="pid_gains_over.i.x" min="0" step=".01" max="5" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_PID_I_GAIN_POS_X_TILT" shortname="PID_ki_x" persistent="true"/>
        <dl_setting var="pid_gains_over.d.x" min="0" step=".01" max="5" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_PID_D_GAIN_POS_X_TILT" shortname="PID_kd_x" persistent="true"/>

        <dl_setting var="pid_gains_over.p.y" min="0" step=".01" max="5" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_PID_P_GAIN_POS_Y_TILT" shortname="PID_kp_y" persistent="true"/>
        <dl_setting var="pid_gains_over.i.y" min="0" step=".01" max="5" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_PID_I_GAIN_POS_Y_TILT" shortname="PID_ki_y" persistent="true"/>
        <dl_setting var="pid_gains_over.d.y" min="0" step=".01" max="5" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_PID_D_GAIN_POS_Y_TILT" shortname="PID_kd_y" persistent="true"/>

        <dl_setting var="pid_gains_over.p.z" min="0" step="1" max="1500" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_PID_P_GAIN_POS_Z" shortname="PID_kp_z" persistent="true"/>
        <dl_setting var="pid_gains_over.i.z" min="0" step="1" max="500" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_PID_I_GAIN_POS_Z" shortname="PID_ki_z" persistent="true"/>
        <dl_setting var="pid_gains_over.d.z" min="0" step="1" max="1000" module="Overactuated_vehicle/Overactuated_mixing" param="OVERACTUATED_MIXING_PID_D_GAIN_POS_Z" shortname="PID_kd_z" persistent="true"/>

      </dl_settings>
    </dl_settings>
  </settings>

  <settings>
    <dl_settings>
      <dl_settings NAME="ground_detect">

        <dl_setting var="min_lidar_alt_ground_detect" min="0" step="0.1" max="2" shortname="min_lidar_alt"/>
        <dl_setting var="az_tolerance_land" min="0" step="0.1" max="5" shortname="az_tolerance_land"/>
        <dl_setting var="time_tolerance_land" min="0" step="0.1" max="2" shortname="time_tolerance_land"/>

      </dl_settings>
    </dl_settings>
  </settings>

  <header>
    <file name="Overactuated_mixing.h"/>
  </header>
   
   <init fun="overactuated_mixing_init()"/>
   <periodic fun="overactuated_mixing_run()" autorun="TRUE" freq="500"/>
   <periodic fun="detect_ground_on_landing()" autorun="TRUE" freq="500"/>
   <!-- <datalink message="GPS_INJECT" fun="overactuated_mixing_parse_SHIP_INFO_MSG(buf)"/> -->
   <!-- <datalink message="TARGET_POS" fun="overactuated_mixing_parse_SHIP_INFO_MSG(buf)"/> -->
   
   <datalink message="SHIP_INFO_MSG" fun="overactuated_mixing_parse_SHIP_INFO_MSG(buf)"/>
   
  <makefile>
    <file name="Overactuated_mixing.c"/>
  </makefile>
</module>
