<!DOCTYPE module SYSTEM "module.dtd">

<module name="fs_landing" dir="fs_landing">
  <doc>
    <description>
      Flat spin controller
    </description>
  </doc>

  <settings>
    <dl_settings name="Flat Spin Landing">
      <dl_settings name="Pre Spin Settings">
        <dl_setting min="0" max="1" var="use_pre_spin" step="1" type="uint8_t" module="fs_landing/fs_landing" />
        <dl_setting min="0" max="5" step="0.01" var="pre_spin_pitch_coeff" type="float" module="fs_landing/fs_landing" />
        <dl_setting min="5" max="15" step="0.1" var="pre_spin_speed_setpoint" type="float" module="fs_landing/fs_landing" />
        <dl_setting min="0" max="1" step="0.01" var="pre_spin_trim_percentage" type="float" module="fs_landing/fs_landing" />
        <dl_setting min="-1" max="15" step="0.5" var="err_test" type="float" module="fs_landing/fs_landing" />
      </dl_settings>
      <dl_settings name="Feed Forward Settings">
        <dl_setting min="0" max="10" step="0.1" shortname="FF Duration" var="ff_duration" type="float" module="fs_landing/feed_forward" />
        <dl_setting min="-1" max="1" step="0.05" shortname="THR_L FF" var="thr_l_ff" type="float" module="fs_landing/feed_forward" />
        <dl_setting min="-1" max="1" step="0.05" shortname="THR_R FF" var="thr_r_ff" type="float" module="fs_landing/feed_forward" />
        <dl_setting min="-1" max="1" step="0.05" shortname="ELEV_L FF" var="elev_l_ff" type="float" module="fs_landing/feed_forward" />
        <dl_setting min="-1" max="1" step="0.05" shortname="ELEV_R FF" var="elev_r_ff" type="float" module="fs_landing/feed_forward" />
        <dl_setting min="-1" max="1" step="0.05" shortname="THR_L Spin" var="thr_l_spinning" type="float" module="fs_landing/feed_forward" />
        <dl_setting min="-1" max="1" step="0.05" shortname="THR_R Spin" var="thr_r_spinning" type="float" module="fs_landing/feed_forward" />
        <dl_setting min="-1" max="1" step="0.05" shortname="ELEV_L Spin" var="elev_l_spinning" type="float" module="fs_landing/feed_forward" />
        <dl_setting min="-1" max="1" step="0.05" shortname="ELEV_R Spin" var="elev_r_spinning" type="float" module="fs_landing/feed_forward" />
      </dl_settings>
<!--      <dl_settings name="Actuator Identification">-->
<!--        <dl_setting min="0" max="5" step="1" var="selected_actuator" shortname="Actuator No" type="uint8_t" module="fs_landing/actuator_id"/>-->
<!--        <dl_setting min="0" max="19400" step="10" var="max_delta_amplitude" shortname="Max Act Delta" type="float" module="fs_landing/actuator_id"/>-->
<!--        <dl_setting min="0" max="1" step="1" values="Inactive|Active" var="act_identification_active" shortname="Activate ID" type="uint8_t" module="fs_landing/fs_landing" handler="actuator_id_handler">-->
<!--          <strip_button name="Act_ID Start" value="1"/>-->
<!--          <strip_button name="Act_ID Stop" value="0"/>-->
<!--        </dl_setting>-->
<!--      </dl_settings>-->
<!--      <dl_settings name="CController">-->
<!--        <dl_setting min="0" max="10" step="0.01" var="cc_kp_gain" shortname="P Gain" type="float" module="fs_landing/cyclic_controller"/>-->
<!--        <dl_setting min="0" max="10" step="0.01" var="cc_kd_gain" shortname="D Gain" type="float" module="fs_landing/cyclic_controller"/>-->
<!--        <dl_setting min="0" max="1" step="0.05" var="max_amplitude" shortname="Ampl" type="float" module="fs_landing/cyclic_controller"/>-->
<!--      </dl_settings>-->
      <dl_settings name="CC FF Square Loop">
        <dl_setting min="0" max="1" step="1" var="cc_feed_forward" shortname="cc_ff_start" type="uint8_t" module="fs_landing/cyclic_control" handler="cc_feed_forward_handler"/>
        <dl_setting min="0" max="10" step="0.1" var="cc_ff_side_time" shortname="side_time" type="float" module="fs_landing/cyclic_control"/>
      </dl_settings>
      <dl_settings name="Cyclic Control">
        <dl_setting min="0" max="1" var="cyclic_control_active" step="1" type="uint8_t" module="fs_landing/fs_landing" />
        <dl_setting min="0" max="1" step="1" var="use_motor_l" type="uint8_t" module="fs_landing/cyclic_control"/>
        <dl_setting min="0" max="1" step="1" var="use_motor_r" type="uint8_t" module="fs_landing/cyclic_control"/>
        <dl_setting min="0" max="1" step="1" var="use_elevon_l" type="uint8_t" module="fs_landing/cyclic_control"/>
        <dl_setting min="0" max="1" step="1" var="use_elevon_r" type="uint8_t" module="fs_landing/cyclic_control"/>
        <dl_setting min="0" max="1" step="1" var="use_elevon_r" type="uint8_t" module="fs_landing/cyclic_control"/>
        <dl_setting min="0" max="1" step="1" var="elevon_delta_active" type="uint8_t" module="fs_landing/cyclic_control"/>
        <dl_setting min="0" max="1" step="1" var="motor_delta_active" type="uint8_t" module="fs_landing/cyclic_control"/>
        <dl_setting min="0" max="1" step="1" var="phase_pilot_control" type="uint8_t" module="fs_landing/cyclic_control"/>
        <dl_setting min="0" max="1" step="1" var="balance_motor_forces" type="uint8_t" module="fs_landing/cyclic_control"/>
<!--        <dl_setting min="0" max="1" step="1" var="use_controller" type="uint8_t" module="fs_landing/cyclic_control" handler="use_controller_handler" />-->
        <dl_setting min="-1" max="1" step="0.05" var="ml_avg" shortname="Avg ML" type="float" module="fs_landing/cyclic_control"/>
        <dl_setting min="0" max="1" step="0.05" var="ml_delta" shortname="Half Amp ML" type="float" module="fs_landing/cyclic_control"/>
        <dl_setting min="-1" max="1" step="0.05" var="mr_avg" shortname="Avg MR" type="float" module="fs_landing/cyclic_control"/>
        <dl_setting min="0" max="1" step="0.05" var="mr_delta" shortname="Half Amp MR" type="float" module="fs_landing/cyclic_control"/>
        <dl_setting min="-1" max="1" step="0.05" var="el_avg" shortname="Avg EL" type="float" module="fs_landing/cyclic_control"/>
        <dl_setting min="0" max="1" step="0.05" var="el_delta" shortname="Half Amp EL" type="float" module="fs_landing/cyclic_control"/>
        <dl_setting min="-1" max="1" step="0.05" var="er_avg" shortname="Avg ER" type="float" module="fs_landing/cyclic_control"/>
        <dl_setting min="0" max="1" step="0.05" var="er_delta" shortname="Half Amp ER" type="float" module="fs_landing/cyclic_control"/>
        <dl_setting min="0" max="360" step="1" var="el_phase" shortname="Phase Elevon" type="float" module="fs_landing/cyclic_control"/>
        <dl_setting min="0" max="360" step="1" var="mt_phase" shortname="Phase Motor" type="float" module="fs_landing/cyclic_control"/>
      </dl_settings>
      <dl_settings name="Act Frequency Test">
        <dl_setting min="0" step="0.01" max="20" var="test_freq" shortname="Frequency" type="float" module="fs_landing/actuator_freq_test"/>
        <dl_setting min="-10000" max="10000" step="1" var="test_min_value" shortname="Min Value" type="float" module="fs_landing/actuator_freq_test"/>
        <dl_setting min="-10000" max="10000" step="1" var="test_max_value" shortname="Max Value" type="float" module="fs_landing/actuator_freq_test"/>
        <dl_setting min="0" max="3" step="1" values="THR_LEFT|ELE_LEFT|ELE_RIGHT|THR_RIGHT" var="actuator_idx" shortname="Actuator" type="uint8_t" module="fs_landing/actuator_freq_test"/>
        <dl_setting min="0" max="1" step="1" values="NO|YES" var="automatic_f" shortname="Automatic input" type="uint8_t" module="fs_landing/actuator_freq_test" />
        <dl_setting min="0" max="1" step="1" values="NO|YES" var="is_input_sin" shortname="Sinusoidal chirp" type="uint8_t" module="fs_landing/actuator_freq_test" />
        <dl_setting min="0" max="2" step="1" values="CALIBRATE|DISCRETE|CONTINUOUS" var="freq_test_mode" shortname="Mode" type="test_mode" module="fs_landing/actuator_freq_test" />
        <dl_setting min="0" max="1" step="1" values="NO|YES" var="cal_reverse" shortname="Thrust reversed" type="uint8_t" module="fs_landing/actuator_freq_test" />
        <dl_setting min="0.1" max="20" step="0.1" var="ramp_min_freq" shortname="r_min_f" type="float" module="fs_landing/actuator_freq_test"/>
        <dl_setting min="0.1" max="20" step="0.1" var="ramp_max_freq" shortname="r_max_f" type="float" module="fs_landing/actuator_freq_test"/>
        <dl_setting min="60" max="300" step="1" var="ramp_duration" shortname="r_dur" type="float" module="fs_landing/actuator_freq_test"/>
      </dl_settings>
      <dl_settings name="Cmpl Filter">
<!--        <dl_setting min="0" max="1" step="0.005" var="heading_weight" type="float" module="fs_landing/my_complementary_filter"/>-->
        <dl_setting min="0" max="75" step="0.01" var="heading_rate_update_gain" shortname="ahrs_gps_gain" type="float" module="subsystems/ahrs/ahrs_float_cmpl"/>
        <dl_setting min="0" max="1" step="0.01" var="mag_update_gain_weight" shortname="ahrs_mag_gain" type="float" module="subsystems/ahrs/ahrs_float_cmpl"/>
        <dl_setting min="0.0001" max="0.1" step="0.0001" var="scaling_factor" shortname="bias_factor" type="float" module="subsystems/ahrs/ahrs_float_cmpl"/>
      </dl_settings>
    </dl_settings>
  </settings>

  <header>
    <file name="fs_landing.h"/>
  </header>

  <init fun="fs_landing_init()"/>
  <periodic fun="fs_landing_run()"/>

  <makefile>
    <file name="fs_landing.c"/>
    <file name="feed_forward.c"/>
    <file name="cyclic_control.c"/>
    <file name="cyclic_controller.c"/>
    <file name="actuator_freq_test.c"/>
<!--    <file name="my_complementary_filter.c"/>-->
  </makefile>

</module>

