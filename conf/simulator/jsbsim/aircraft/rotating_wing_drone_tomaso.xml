<?xml version="1.0"?>
<?xml-stylesheet type="text/xsl" href="http://jsbsim.sourceforge.net/JSBSim.xsl"?>
<fdm_config name="QUAD COMPLETE EXT" version="2.0" release="BETA" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://jsbsim.sourceforge.net/JSBSim.xsd">

    <fileheader>
        <author>Tomaso De Ponti</author>
        <filecreationdate>23-12-2021</filecreationdate>
        <version>Version 0.9 - beta</version>
        <description>Rotating wing drone with actuator dynamics</description>
    </fileheader>

    <metrics>
        <wingarea unit="IN2">480</wingarea>
        <wingspan unit="IN">50.8</wingspan>
        <chord unit="IN">9.45</chord>
        <htailarea unit="FT2">0.952</htailarea>
        <htailarm unit="FT">1.903</htailarm>
        <vtailarea unit="FT2">0.462</vtailarea>
        <vtailarm unit="FT">1.903</vtailarm>
        <location name="AERORP" unit="IN">
            <x> 0 </x>
            <y> 0 </y>
            <z> 0 </z>
        </location>
        <location name="EYEPOINT" unit="IN">
            <x> 0 </x>
            <y> 0 </y>
            <z> 0 </z>
        </location>
        <location name="VRP" unit="IN">
            <x> 0 </x>
            <y> 0 </y>
            <z> 0 </z>
        </location>
    </metrics>

    <mass_balance>
        <ixx unit="SLUG*FT2">0.1526754</ixx> <!-- 0.03328-->
        <iyy unit="SLUG*FT2">0.579724</iyy>  <!-- 0.25055-->
        <izz unit="SLUG*FT2">0.684457</izz>  <!-- 0.1737-->
        <ixy unit="SLUG*FT2">0.</ixy>
        <ixz unit="SLUG*FT2">0.</ixz>
        <iyz unit="SLUG*FT2">0.</iyz>
            <emptywt unit="LBS">66.14</emptywt> <!-- 6.614 12.57 -->
        <location name="CG" unit="IN">
            <x> 0 </x>
            <y> 0 </y>
            <z> 0 </z>
        </location>
    </mass_balance>

    <ground_reactions>
        <contact type="STRUCTURE" name="CONTACT_FRONT">
            <location unit="M">
                <x>-0.4 </x>
                <y> 0 </y>
                <z>-0.1 </z>
            </location>
            <static_friction>  0.8 </static_friction>
            <dynamic_friction> 0.5 </dynamic_friction>
            <spring_coeff unit="N/M"> 500 </spring_coeff>
            <damping_coeff unit="N/M/SEC"> 100 </damping_coeff>
            <damping_coeff_rebound type="SQUARE" unit="N/M2/SEC2"> 1000 </damping_coeff_rebound>
            <max_steer unit="DEG"> 0.0 </max_steer>
            <brake_group> NONE </brake_group>
            <retractable>0</retractable>
        </contact>

        <contact type="STRUCTURE" name="CONTACT_BACK">
            <location unit="M">
                <x> 0.4</x>
                <y> 0   </y>
                <z>-0.1 </z>
            </location>
            <static_friction>  0.8 </static_friction>
            <dynamic_friction> 0.5 </dynamic_friction>
            <spring_coeff unit="N/M"> 500 </spring_coeff>
            <damping_coeff unit="N/M/SEC"> 100 </damping_coeff>
            <damping_coeff_rebound type="SQUARE" unit="N/M2/SEC2"> 1000 </damping_coeff_rebound>
            <max_steer unit="DEG"> 0.0 </max_steer>
            <brake_group> NONE </brake_group>
            <retractable>0</retractable>
        </contact>

        <contact type="STRUCTURE" name="CONTACT_RIGHT">
            <location unit="M">
                <x> 0.  </x>
                <y> 0.4</y>
                <z>-0.1 </z>
            </location>
            <static_friction>  0.8 </static_friction>
            <dynamic_friction> 0.5 </dynamic_friction>
            <spring_coeff unit="N/M"> 500 </spring_coeff>
            <damping_coeff unit="N/M/SEC"> 100 </damping_coeff>
            <damping_coeff_rebound type="SQUARE" unit="N/M2/SEC2"> 1000 </damping_coeff_rebound>
            <max_steer unit="DEG"> 0.0 </max_steer>
            <brake_group> NONE </brake_group>
            <retractable>0</retractable>
        </contact>

        <contact type="STRUCTURE" name="CONTACT_LEFT">
            <location unit="M">
                <x> 0.  </x>
                <y>-0.4</y>
                <z>-0.1 </z>
            </location>
            <static_friction>  0.8 </static_friction>
            <dynamic_friction> 0.5 </dynamic_friction>
            <spring_coeff unit="N/M"> 500 </spring_coeff>
            <damping_coeff unit="N/M/SEC"> 100 </damping_coeff>
            <damping_coeff_rebound type="SQUARE" unit="N/M2/SEC2"> 1000 </damping_coeff_rebound>
            <max_steer unit="DEG"> 0.0 </max_steer>
            <brake_group> NONE </brake_group>
            <retractable>0</retractable>
        </contact>
  </ground_reactions>

    <flight_control name="actuator_dynamics">
        <channel name="filtering">
            <lag_filter name="ail_left_lag">
                <input> fcs/ail_left </input>
                <c1> 52.8 </c1>
                <output> fcs/ail_left_lag</output>
            </lag_filter>
            <lag_filter name="ail_right_lag">
                <input> fcs/ail_right </input>
                <c1> 52.8 </c1>
                <output> fcs/ail_right_lag</output>
            </lag_filter>
             <lag_filter name="elev_lag">
                <input> fcs/elev </input>
                <c1> 52.8 </c1>
                <output> fcs/elev_lag</output>
            </lag_filter>
            <lag_filter name="rud_lag">
                <input> fcs/rud </input>
                <c1> 52.8 </c1>
                <output> fcs/rud_lag</output>
            </lag_filter>                                   
            <lag_filter name="front_motor_lag">
                <input> fcs/front_motor </input>
                <c1> 24.07 </c1>
                <output> fcs/front_motor_lag</output>
            </lag_filter>
            <lag_filter name="right_motor_lag">
                <input> fcs/right_motor </input>
                <c1> 24.07 </c1>
                <output> fcs/right_motor_lag</output>
            </lag_filter>
            <lag_filter name="back_motor_lag">
                <input> fcs/back_motor </input>
                <c1> 24.07 </c1>
                <output> fcs/back_motor_lag</output>
            </lag_filter>
            <lag_filter name="left_motor_lag">
                <input> fcs/left_motor </input>
                <c1> 24.07 </c1>
                <output> fcs/left_motor_lag</output>
            </lag_filter>
            <lag_filter name="pusher_lag">
                <input> fcs/pusher </input>
                <c1> 24.07 </c1>
                <output> fcs/pusher_lag </output>
            </lag_filter>
        </channel>
    </flight_control>

    <external_reactions>
        <property>fcs/front_motor</property>
        <property>fcs/front_motor_lag</property>
        <property>fcs/right_motor</property>
        <property>fcs/right_motor_lag</property>
        <property>fcs/back_motor</property>                    
        <property>fcs/back_motor_lag</property>
        <property>fcs/left_motor</property>
        <property>fcs/left_motor_lag</property>
        <property>fcs/ail_left</property>
        <property>fcs/ail_right</property>
        <property>fcs/elev</property>
        <property>fcs/rud</property>
        <property>fcs/ail_left_lag</property>
        <property>fcs/ail_right_lag</property>
        <property>fcs/elev_lag</property>
        <property>fcs/rud_lag</property>
        <property>fcs/pusher</property>
        <property>fcs/pusher_lag</property>
        <property>fcs/wing_rotation</property>

        <!-- First lift forces produced by each propeller -->    

        <!--<force name="front_motor" frame="BODY" unit="LBS">
            <function>
                <product>
                    <property>fcs/front_motor_lag</property>
                    <value>3.5598</value>
                </product>
            </function>
            <location unit="IN">
                <x>-13.78</x>
                <y>0</y>
                <z>0</z>
            </location>
            <direction>
                <x>0</x>
                <y>0</y>
                <z>-1</z>
            </direction>
        </force>
        <force name="right_motor" frame="BODY" unit="LBS">
            <function>
                <product>
                    <property>fcs/right_motor_lag</property>
                    <value>3.5598</value>
                </product>
            </function>
            <location unit="IN">
                <x>0</x>
                <y>13.78</y>
                <z>0</z>
            </location>
            <direction>
                <x>0</x>
                <y>0</y>
                <z>-1</z>
            </direction>
        </force>
        <force name="back_motor" frame="BODY" unit="LBS">
            <function>
                <product>
                    <property>fcs/back_motor_lag</property>
                    <value>3.5598</value>
                </product>
            </function>
            <location unit="IN">
                <x>13.78</x>
                <y>0</y>
                <z>0</z>
            </location>
            <direction>
                <x>0</x>
                <y>0</y>
                <z>-1</z>
            </direction>
        </force>
        <force name="left_motor" frame="BODY" unit="LBS">
            <function>
                <product>
                    <property>fcs/left_motor_lag</property>
                    <value>3.5598</value>
                </product>
            </function>
            <location unit="IN">
                <x>0</x>
                <y>-13.78</y>
                <z>0</z>
            </location>
            <direction>
                <x>0</x>
                <y>0</y>
                <z>-1</z>
            </direction>
        </force>-->

        <!-- Thrust created by pusher prop-->
        <force name="pusher" frame="BODY" unit="LBS">
            <function>
                <product>
                    <sum>
                        <property>fcs/pusher_lag</property>
                        <value> -0.035 </value>
                    </sum>
                    <value>5.512</value>
                </product>
            </function>
            <location unit="IN">
                <x>0</x>
                <y>0</y>
                <z>0</z>
            </location>
            <direction>
                <x>1</x>
                <y>0</y>
                <z>0</z>
            </direction>
        </force>

        <!-- Thrust Bz created by motors
        <force name="thrust_bz" frame="BODY" unit="LBS">
            <function>
                <sum>
                    <product>
                        <property>fcs/front_motor_lag</property>
                        <value>3.5598</value>
                    </product>
                    <product>
                        <property>fcs/right_motor_lag</property>
                        <value>3.5598</value>
                    </product>
                    <product>
                        <property>fcs/back_motor_lag</property>
                        <value>3.5598</value>
                    </product>
                    <product>
                        <property>fcs/left_motor_lag</property>
                        <value>3.5598</value>
                    </product>
                </sum>
            </function>
            <location unit="IN">
                <x>0</x>
                <y>0</y>
                <z>0</z>
            </location>
            <direction>
                <x>0</x>
                <y>0</y>
                <z>-1</z>
            </direction>
        </force> -->

        <!-- Roll moments created by motors -->
        <force name="roll_right_motor" frame="BODY" unit="LBS">
            <function>
                <product>
                    <property>fcs/right_motor_lag</property>
                    <value>3.5598</value>
                    <cos><product><value>1.5708</value><property>fcs/wing_rotation</property></product></cos>
                </product>
            </function>
            <location unit="IN">
                <x>0</x>
                <y>13.78</y>
                <z>0</z>
            </location>
            <direction>
                <x>0</x>
                <y>0</y>
                <z>-1</z>
            </direction>
        </force>

        <force name="roll_left_motor" frame="BODY" unit="LBS">
            <function>
                <product>
                    <property>fcs/left_motor_lag</property>
                    <value>3.5598</value>
                    <cos><product><value>1.5708</value><property>fcs/wing_rotation</property></product></cos>
                </product>
            </function>
            <location unit="IN">
                <x>0</x>
                <y>-13.78</y>
                <z>0</z>
            </location>
            <direction>
                <x>0</x>
                <y>0</y>
                <z>-1</z>
            </direction>
        </force>

        <!-- Pitch moments created by motors-->
        <force name="pitch_front_motor" frame="BODY" unit="LBS">
            <function>
                <product>
                    <property>fcs/front_motor_lag</property>
                    <value>3.5598</value>
                </product>
            </function>
            <location unit="IN">
                <x>-13.78</x>
                <y>0</y>
                <z>0</z>
            </location>
            <direction>
                <x>0</x>
                <y>0</y>
                <z>-1</z>
            </direction>
        </force>

        <force name="pitch_right_motor" frame="BODY" unit="LBS">
            <function>
                <product>
                    <property>fcs/right_motor_lag</property>
                    <value>3.5598</value>
                    <sin><product><value>1.5708</value><property>fcs/wing_rotation</property></product></sin>
                </product>
            </function>
            <location unit="IN">
                <x>13.78</x>
                <y>0</y>
                <z>0</z>
            </location>
            <direction>
                <x>0</x>
                <y>0</y>
                <z>-1</z>
            </direction>
        </force>

        <force name="pitch_back_motor" frame="BODY" unit="LBS">
            <function>
                <product>
                    <property>fcs/back_motor_lag</property>
                    <value>3.5598</value>
                </product>
            </function>
            <location unit="IN">
                <x>13.78</x>
                <y>0</y>
                <z>0</z>
            </location>
            <direction>
                <x>0</x>
                <y>0</y>
                <z>-1</z>
            </direction>
        </force>

        <force name="pitch_left_motor" frame="BODY" unit="LBS">
            <function>
                <product>
                    <property>fcs/left_motor_lag</property>
                    <value>3.5598</value>
                    <sin><product><value>1.5708</value><property>fcs/wing_rotation</property></product></sin>
                </product>
            </function>
            <location unit="IN">
                <x>-13.78</x>
                <y>0</y>
                <z>0</z>
            </location>
            <direction>
                <x>0</x>
                <y>0</y>
                <z>-1</z>
            </direction>
        </force>

        <!-- Yaw moments created by motors -->
        
        <force name="front_couple1" frame="BODY" unit="LBS">
            <function>
                <product>
                    <property>fcs/front_motor_lag</property>
                    <value>0.657</value>
                    <value>20</value>
                </product>
            </function>
            <location unit="IN">
                <x>0</x>
                <y>0.5</y>
                <z>0</z>
            </location>
            <direction>
                <x>-1</x>
                <y>0</y>
                <z>0</z>
            </direction>
        </force>    
        <force name="front_couple2" frame="BODY" unit="LBS">
            <function>
                <product>
                    <property>fcs/front_motor_lag</property>
                    <value>0.657</value>
                    <value>20</value>
                </product>
            </function>
            <location unit="IN">
                <x>0</x>
                <y>-0.5</y>
                <z>0</z>
            </location>
            <direction>
                <x>1</x>
                <y>0</y>
                <z>0</z>
            </direction>
        </force>

        <force name="right_couple1" frame="BODY" unit="LBS">
            <function>
                <product>
                    <property>fcs/right_motor_lag</property>
                    <value>0.657</value>
                    <value>20</value>
                </product>
            </function>
            <location unit="IN">
                <x>0</x>
                <y>0.5</y>
                <z>0</z>
            </location>
            <direction>
                <x>1</x>
                <y>0</y>
                <z>0</z>
            </direction>
        </force>    
        <force name="right_couple2" frame="BODY" unit="LBS">
            <function>
                <product>
                    <property>fcs/right_motor_lag</property>
                    <value>0.657</value>
                    <value>20</value>
                </product>
            </function>
            <location unit="IN">
                <x>0</x>
                <y>-0.5</y>
                <z>0</z>
            </location>
            <direction>
                <x>-1</x>
                <y>0</y>
                <z>0</z>
            </direction>
        </force>

        <force name="back_couple1" frame="BODY" unit="LBS">
            <function>
                <product>
                    <property>fcs/back_motor_lag</property>
                    <value>0.657</value>
                    <value>20</value>
                </product>
            </function>
            <location unit="IN">
                <x>0</x>
                <y>0.5</y>
                <z>0</z>
            </location>
            <direction>
                <x>-1</x>
                <y>0</y>
                <z>0</z>
            </direction>
        </force>    
        <force name="back_couple2" frame="BODY" unit="LBS">
            <function>
                <product>
                    <property>fcs/back_motor_lag</property>
                    <value>0.657</value>
                    <value>20</value>
                </product>
            </function>
            <location unit="IN">
                <x>0</x>
                <y>-0.5</y>
                <z>0</z>
            </location>
            <direction>
                <x>1</x>
                <y>0</y>
                <z>0</z>
            </direction>
        </force>

        <force name="left_couple1" frame="BODY" unit="LBS">
            <function>
                <product>
                    <property>fcs/left_motor_lag</property>
                    <value>0.657</value>
                    <value>20</value>
                </product>
            </function>
            <location unit="IN">
                <x>0</x>
                <y>0.5</y>
                <z>0</z>
            </location>
            <direction>
                <x>1</x>
                <y>0</y>
                <z>0</z>
            </direction>
        </force>    
        <force name="left_couple2" frame="BODY" unit="LBS">
            <function>
                <product>
                    <property>fcs/left_motor_lag</property>
                    <value>0.657</value>
                    <value>20</value>
                </product>
            </function>
            <location unit="IN">
                <x>0</x>
                <y>-0.5</y>
                <z>0</z>
            </location>
            <direction>
                <x>-1</x>
                <y>0</y>
                <z>0</z>
            </direction>
        </force>                     
                           
    </external_reactions>

    <propulsion/>

    <flight_control name="FGFCS"/>
    <aerodynamics file="Systems/aerodynamics_rotwing.xml"/>
</fdm_config>
 